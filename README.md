# L0 Order Service

ะะธะบัะพัะตัะฒะธั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Kafka, PostgreSQL ะธ ะบััะธัะพะฒะฐะฝะธั ะฒ ะฟะฐะผััะธ.

## ๐ ะะพะทะผะพะถะฝะพััะธ

- **Kafka Consumer**: ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะพะฒ ะธะท ะพัะตัะตะดะธ Kafka
- **PostgreSQL**: ะะฐะดะตะถะฝะพะต ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ั ััะฐะฝะทะฐะบัะธัะผะธ  
- **In-Memory Cache**: ะัััััะน ะดะพัััะฟ ะบ ะดะฐะฝะฝัะผ ัะตัะตะท ะบัั
- **REST API**: HTTP API ะดะปั ะฟะพะปััะตะฝะธั ะทะฐะบะฐะทะพะฒ ะฟะพ ID
- **ะะตะฑ-ะธะฝัะตััะตะนั**: ะัะพััะฐั ะฒะตะฑ-ัััะฐะฝะธัะฐ ะดะปั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ
- **Docker**: ะะพะปะฝะฐั ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- **Kafka Producer**: ะกะบัะธะฟั-ัะผัะปััะพั ะดะปั ะณะตะฝะตัะฐัะธะธ ัะตััะพะฒัั ะทะฐะบะฐะทะพะฒ

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ  Kafka Producer โโโโโถโ     Kafka       โโโโโถโ  Order Service  โ
โ   (Generator)   โ    โ   (Message      โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โ    Broker)      โ    โ  โโโโโโโโโโโโโโโโค
                       โโโโโโโโโโโโโโโโโโโ    โ  โ HTTP Server  โ
โโโโโโโโโโโโโโโโโโโ                           โ  โ (Port 8080)  โ
โ   Web Browser   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโค
โโโโโโโโโโโโโโโโโโโ                           โ  โโโโโโโโโโโโโโโโค
                                              โ  โ    Cache     โ
โโโโโโโโโโโโโโโโโโโ                           โ  โ (In-Memory)  โ
โ   PostgreSQL    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโค
โ  (Port 5433)    โ                           โโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโ
```

## ๐๏ธ ะัััััะน ะทะฐะฟััะบ

### 1. ะะฐะฟััะบ ะฒัะตะน ัะธััะตะผั
```bash
docker-compose up -d
```

### 2. ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะพะฒ
```bash
docker-compose ps
```

### 3. ะัะฟัะฐะฒะบะฐ ัะตััะพะฒัั ะทะฐะบะฐะทะพะฒ
```bash
# ะะตัะตัะพะด ะฒ ะฟะฐะฟะบั ัะพ ัะบัะธะฟัะฐะผะธ
cd producer

# ะัะฟัะฐะฒะบะฐ ะพะดะฝะพะณะพ ะทะฐะบะฐะทะฐ
go run kafka_producer.go -count=1

# ะัะฟัะฐะฒะบะฐ 5 ะทะฐะบะฐะทะพะฒ ั ะทะฐะดะตัะถะบะพะน 2 ัะตะบัะฝะดั
go run kafka_producer.go -count=5 -delay=2s

# ะะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ะณะพัะพะฒัะต ัะบัะธะฟัั
send_orders.bat          # Windows batch
demo.bat                 # ะะตะผะพะฝัััะฐัะธั ัะธััะตะผั
```

### 4. ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ
ะัะบัะพะนัะต http://localhost:8080/ ะฒ ะฑัะฐัะทะตัะต ะธ ะฒะฒะตะดะธัะต Order UID ะดะปั ะฟะพะธัะบะฐ.

## ๐ง ะะพัััะฟะฝัะต ัะตัะฒะธัั

| ะกะตัะฒะธั | ะะดัะตั | ะะฟะธัะฐะฝะธะต |
|--------|-------|----------|
| **Order Service** | http://localhost:8080/ | ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ |
| **Order API** | http://localhost:8080/order/{order_uid} | REST API ะดะปั ะฟะพะปััะตะฝะธั ะทะฐะบะฐะทะฐ |
| **Kafka UI** | http://localhost:8081/ | ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั Kafka |
| **PostgreSQL** | localhost:5433 | ะะฐะทะฐ ะดะฐะฝะฝัั (user: order_user, db: orders_service) |
| **Kafka** | localhost:9093 | ะะฝะตัะฝะธะน ะฟะพัั ะดะปั ะฟะพะดะบะปััะตะฝะธั ะบ Kafka |

## ๐ ะขะตััะธัะพะฒะฐะฝะธะต ัะธััะตะผั

### API ัะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ ะฟะพ ID
curl http://localhost:8080/order/order_1_1234567890

# PowerShell
Invoke-WebRequest -Uri http://localhost:8080/order/order_1_1234567890 -UseBasicParsing
```

### ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
```bash
# ะะพะณะธ ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose logs app

# ะะพะณะธ ะฒัะตั ัะตัะฒะธัะพะฒ  
docker-compose logs

# ะกะปะตะดะธัั ะทะฐ ะปะพะณะฐะผะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
docker-compose logs -f app
```

### ะะพะฝะธัะพัะธะฝะณ Kafka
1. ะัะบัะพะนัะต http://localhost:8081/
2. ะะตัะตะนะดะธัะต ะฒ Topics โ orders
3. ะัะพัะผะพััะธัะต ัะพะพะฑัะตะฝะธั ะธ ะบะพะฝัััะผะตัั

## ๐ฏ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
L0/
โโโ cmd/server/           # ะขะพัะบะฐ ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั
โ   โโโ main.go
โโโ internal/             # ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ
โ   โโโ cache/           # ะััะธัะพะฒะฐะฝะธะต ะฒ ะฟะฐะผััะธ  
โ   โโโ config/          # ะะพะฝัะธะณััะฐัะธั
โ   โโโ database/        # ะะฐะฑะพัะฐ ั PostgreSQL
โ   โโโ handlers/        # HTTP ะพะฑัะฐะฑะพััะธะบะธ
โ   โโโ kafka/          # Kafka consumer
โ   โโโ models/         # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ web/            # ะะตะฑ-ะธะฝัะตััะตะนั
โโโ scripts/            # ะกะบัะธะฟัั ะดะปั ัะตััะธัะพะฒะฐะฝะธั
โ   โโโ kafka_producer.go  # ะะตะฝะตัะฐัะพั ะทะฐะบะฐะทะพะฒ
โ   โโโ Send-Orders.ps1    # PowerShell ัะบัะธะฟั
โ   โโโ send_orders.bat    # Batch ัะบัะธะฟั  
โ   โโโ demo.bat          # ะะตะผะพะฝัััะฐัะธั
โ   โโโ README.md         # ะะพะบัะผะตะฝัะฐัะธั ัะบัะธะฟัะพะฒ
โโโ web/                # ะะตะฑ-ัะตััััั
โ   โโโ static/         # CSS, JS ัะฐะนะปั
โ   โโโ templates/      # HTML ัะฐะฑะปะพะฝั
โโโ migrations/         # SQL ะผะธะณัะฐัะธะธ
โโโ docker-compose.yml  # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ Dockerfile         # ะะฑัะฐะท ะฟัะธะปะพะถะตะฝะธั
```

## ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- **ะัั ะฒ ะฟะฐะผััะธ** ั concurrent-safe ะดะพัััะฟะพะผ (sync.RWMutex)
- **Connection pooling** ะดะปั PostgreSQL
- **Batch ะพะฟะตัะฐัะธะธ** ะดะปั ะผะฐััะพะฒะพะน ะพะฑัะฐะฑะพัะบะธ

### ะะฐะดะตะถะฝะพััั  
- **ะขัะฐะฝะทะฐะบัะธะธ** ะฒ PostgreSQL ะดะปั ะบะพะฝัะธััะตะฝัะฝะพััะธ ะดะฐะฝะฝัั
- **Graceful shutdown** ั ะบะพััะตะบัะฝัะผ ะทะฐะบัััะธะตะผ ัะพะตะดะธะฝะตะฝะธะน
- **Error handling** ะฝะฐ ะฒัะตั ััะพะฒะฝัั ะฟัะธะปะพะถะตะฝะธั
- **ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั** ะฒัะพะดััะธั ัะพะพะฑัะตะฝะธะน

### ะะฐัััะฐะฑะธััะตะผะพััั
- **Stateless ะฐััะธัะตะบัััะฐ** ะดะปั ะณะพัะธะทะพะฝัะฐะปัะฝะพะณะพ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั  
- **Kafka consumer groups** ะดะปั ัะฐัะฟัะตะดะตะปะตะฝะธั ะฝะฐะณััะทะบะธ
- **Docker ะบะพะฝัะตะนะฝะตัั** ะดะปั ะฟัะพััะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั

## ๐ง ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|------------|----------|--------------|
| `DB_HOST` | ะฅะพัั PostgreSQL | localhost |
| `DB_PORT` | ะะพัั PostgreSQL | 5432 |
| `DB_USER` | ะะพะปัะทะพะฒะฐัะตะปั ะะ | order_user |
| `DB_PASSWORD` | ะะฐัะพะปั ะะ | order_pass |
| `DB_NAME` | ะะฐะทะฒะฐะฝะธะต ะะ | orders_service |
| `KAFKA_BROKER` | ะะดัะตั Kafka ะฑัะพะบะตัะฐ | localhost:9092 |
| `SERVER_PORT` | ะะพัั HTTP ัะตัะฒะตัะฐ | :8080 |

##  ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะฟัะฐะฒะบะฐ ะทะฐะบะฐะทะฐ ัะตัะตะท Kafka Producer
```bash
cd producer
go run kafka_producer.go -count=1 -delay=0s
```

### ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ ัะตัะตะท API
```bash
curl http://localhost:8080/order/order_1_1234567890
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ
1. ะะตัะตะนะดะธัะต ะฝะฐ http://localhost:8080/
2. ะะฒะตะดะธัะต Order UID ะฒ ะฟะพะปะต ะฟะพะธัะบะฐ
3. ะะฐะถะผะธัะต "ะะฐะนัะธ"
4. ะะพะปััะธัะต JSON ั ะดะฐะฝะฝัะผะธ ะทะฐะบะฐะทะฐ

##  ะะพะปะฝัะน ัะตัั ัะธััะตะผั

```bash
# 1. ะะฐะฟััะบ ัะธััะตะผั
docker-compose up -d

# 2. ะะพะดะพะถะดะฐัั ะทะฐะฟััะบะฐ (30-60 ัะตะบัะฝะด)
docker-compose logs app

# 3. ะัะฟัะฐะฒะธัั ัะตััะพะฒัะต ะทะฐะบะฐะทั  
cd producer
go run kafka_producer.go -count=3 -delay=1s

# 4. ะัะพะฒะตัะธัั ะพะฑัะฐะฑะพัะบั ะฒ ะปะพะณะฐั
docker-compose logs app | grep "ััะฟะตัะฝะพ ะพะฑัะฐะฑะพัะฐะฝ"

# 5. ะะพะปััะธัั ะทะฐะบะฐะท ัะตัะตะท API
curl http://localhost:8080/order/order_1_XXXXXXXXX

# 6. ะัะบัััั ะฒะตะฑ-ะธะฝัะตััะตะนั
start http://localhost:8080/
```

## ะััะฐะฝะพะฒะบะฐ ัะธััะตะผั

```bash
# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose down

# ะััะฐะฝะพะฒะบะฐ ั ัะดะฐะปะตะฝะธะตะผ ัะพะผะพะฒ (ะพััะพัะพะถะฝะพ - ัะดะฐะปะธั ะดะฐะฝะฝัะต!)
docker-compose down -v
```

